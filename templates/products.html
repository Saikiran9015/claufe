<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Products - Claufe.</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
  <script src="{{ url_for('static', filename='script.js') }}"></script>
</head>

<body class="admin-shell">

<header class="admin-header">
      <div class="landing-logo">
        <img src="{{ url_for('static', filename='4.png') }}" class="logo-img" alt="Logo">
        
    </div>
  <div>
    {% if session.get('name') %}
      <span style="margin-right:12px;">
        {{ session.get('name') }} ({{ session.get('role') }})
      </span>
      <a href="{{ url_for('logout') }}" class="landing-admin-link">Logout</a>
    {% endif %}
  </div>
</header>

<a href="{{ url_for('landing') }}">
  <button class="btn btn-outline" style="margin-left:32px; margin-top:10px;">
    ← Go to Home Page
  </button>
</a>

<!-- NAVIGATION -->
<nav class="admin-nav">
  <a href="{{ url_for('admin_dashboard') }}">
    <button class="admin-tab {{ 'active' if active_page=='dashboard' else '' }}">Dashboard</button>
  </a>

  <a href="{{ url_for('admin_products') }}">
    <button class="admin-tab {{ 'active' if active_page=='products' else '' }}">Products</button>
  </a>

  <a href="{{ url_for('add_product') }}">
    <button class="admin-tab {{ 'active' if active_page=='upload' else '' }}">Product Images</button>
  </a>

  <!-- FIXED: Correct analytics endpoint -->
  <a href="{{ url_for('admin_analytics') }}">
    <button class="admin-tab {{ 'active' if active_page=='analytics' else '' }}">Analytics</button>
  </a>

  <a href="{{ url_for('admin_banners') }}">
    <button class="admin-tab {{ 'active' if active_page=='banners' else '' }}">Banners</button>
  </a>
</nav>

<main class="admin-content">

  <h2>Products</h2>

  <!-- FLASH MESSAGES -->
  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      {% for category, msg in messages %}
        <div class="alert alert-{{ category }}">{{ msg }}</div>
      {% endfor %}
    {% endif %}
  {% endwith %}

  <div class="table-wrapper">

    <div class="table-header">
      <div class="table-title">All Products</div>

      <div>
        <input id="searchProducts"
               class="table-search"
               placeholder="Search products..."
               onkeyup="filterTable('searchProducts','productsTable')">

        <a href="{{ url_for('add_product') }}"
           class="btn btn-primary"
           style="text-decoration:none;margin-left:8px;">
          + Add Product
        </a>
      </div>
    </div>

    <table class="table" id="productsTable">
      <thead>
        <tr>
          <th>#</th>
          <th>Image</th>
          <th>Name</th>
          <th>Price</th>
          <th>Created</th>
          <th>Actions</th>
        </tr>
      </thead>

      <tbody>
        {% for p in products %}
        <tr>

          <td>{{ loop.index }}</td>

          <td>
            {% if p['image_filename'] %}
              <img src="{{ url_for('uploaded_file', filename=p['image_filename']) }}"
                   style="width:48px;height:48px;object-fit:cover;border-radius:8px;">
            {% else %}
              —
            {% endif %}
          </td>

          <td>{{ p['name'] }}</td>

          <td>₹{{ '%.2f'|format(p['price']) }}</td>

          <td>
            {{ p['created_at'].strftime('%Y-%m-%d') if p['created_at'] else '' }}
          </td>

          <td>
            <form id="deleteForm{{ p['_id'] }}"
                  method="POST"
                  action="{{ url_for('delete_product', product_id=p['_id']) }}"
                  style="display:inline;">

              <button type="button"
                      class="btn btn-danger"
                      onclick="confirmDelete('deleteForm{{ p['_id'] }}')">
                Delete
              </button>
            </form>
          </td>

        </tr>
        {% else %}
        <tr>
          <td colspan="6">No products yet.</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>

  </div>

</main>

</body>
</html>
